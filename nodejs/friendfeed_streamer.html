<!DOCTYPE html>
<html>
	<head>
		<title>Gnostos</title>

		<style type="text/css">
			body
			{
				position:absolute;
				width:200px;
				overflow-x:hidden;
				overflow-y:auto;
				border:0;
				word-wrap: break-word;			
				background-color:#ffffff;
			}
			.accountname
			{
				position:absolute;
				width:125px;
				overflow-x:hidden;
				overflow-y:auto;			
				font-family: arial,sans-serif;
				font-size: 16px;
				font-weight: bold;
			}
			.accountemail
			{
				font-family: arial,sans-serif;
				font-size:14px;
			}
			.feedtitle
			{
				background: #ededed;
				border: solid 1px #ccc;			
				font-family: arial,sans-serif;
				font-size:15px;
				padding: 5px;
			}
			.feeds
			{
				border: solid 1px #ccc;
				font-family: arial,sans-serif;
				font-size:14px;
				padding: 2px;
			}
			
		</style>
		
		<script type="text/javascript">
		// INSERT EMAILID/USERNAME HERE
		</script>
	</head>
	<body width="200">
		<table>
			<tr>
				<td width="75">
					<img width="75" id="profileimage" alt="Profile Image"/>
				</td>
				
				<td id="accountname" class="accountname" width="125">
				</td>
			</tr>
		</table>

		<div id="accountemail" class="accountemail"></div>
		<div id="twittertitle" class="feedtitle" onmousedown="togglevisibility('twitterfeed')"></div>
		<div id="twitterfeed" class="feeds"></div>
		<script type="text/javascript">

		function togglevisibility(obj) {
			var el = document.getElementById(obj);
			if ( el.style.display != 'none' ) {
				el.style.display = 'none';
			}
			else {
				el.style.display = '';
			}
		}
				
		function load_tweets() {
			var twittertitle = document.getElementById('twittertitle');
			var profileimage = document.getElementById('profileimage');
			profileimage.style.display = 'none';
			
			twittertitle.innerHTML = "Looking up " + emailid + "...";
			if (window.XMLHttpRequest)
			{
				var xmlhttp=new XMLHttpRequest();
				xmlhttp.open("GET","/stream?email="+emailid+"&name="+username,true);
				//xmlhttp.onprogress = onXHRProgress;
				xmlhttp.onload = onXHRLoad;
				xmlhttp.onerror = onXHRError;
				//xmlhttp.onreadystatechange = gnostos.onXHRReadyStateChange;
				xmlhttp.send();
			}
		}

		function onXHRLoad(e)
		{
		    var xmlDoc = this.responseXML;
		    if(!xmlDoc)
		    {
		    	twittertitle.innerHTML = "Could not fetch contact information, please try again later!";
		    	return;
		    }
			
			//alert(this.responseText);
		    var twitterfeed = document.getElementById('twitterfeed');
		    var profileimage = document.getElementById('profileimage');
		    profileimage.style.display = '';
		    
		    var twittertitle = document.getElementById('twittertitle');

		    twittertitle.innerHTML = "";
		    
		    var accountname = document.getElementById('accountname');
		    var accountemail = document.getElementById('accountemail');
		    			    
		    var titleElements = xmlDoc.getElementsByTagName("title");
		    var nicknameElements = xmlDoc.getElementsByTagName("nickname");
		    var nameElements = xmlDoc.getElementsByTagName("name");
		   		   
			var feed = "";
		    for(var i = 0; i < titleElements.length; ++i)
		    {
		        feed += "<div>" + titleElements[i].childNodes[0].nodeValue + "</div>";
		    }
		    //http://api.twitter.com/1/users/profile_image/deepakprab
		    if(nicknameElements[0] && nicknameElements[0].childNodes[0].nodeValue)
		    	profileimage.setAttribute("src", "http://friendfeed-api.com/v2/picture/" + nicknameElements[0].childNodes[0].nodeValue + "?size=large");
		    accountname.innerHTML = username;//nameElements[0].childNodes[0].nodeValue;
		    accountemail.innerHTML = emailid;
		    twittertitle.innerHTML = "Twitter";
		    twitterfeed.innerHTML = feed;
		}

		function onXHRError(e)
		{
			//alert("error");
		    var twittertitle = document.getElementById('twittertitle');
		    var profileimage = document.getElementById('profileimage');
		    profileimage.style.display = 'none';

		    twittertitle.innerHTML = "Could not connect!";
			
		}
				
		//setTimeout(load_tweets, 1000);
		load_tweets();
		</script>
	</body>
</html>
